document.addEventListener("DOMContentLoaded",function(){const form=document.getElementById("signupForm");const userTypeSelect=document.getElementById("userType");const entrepriseFields=document.getElementById("entrepriseFields");const etudiantFields=document.getElementById("etudiantFields");const encadrantFields=document.getElementById("encadrantFields");userTypeSelect.addEventListener("change",function(){entrepriseFields.classList.add("d-none");etudiantFields.classList.add("d-none");encadrantFields.classList.add("d-none");switch(this.value){case"entreprise":entrepriseFields.classList.remove("d-none");break;case"etudiant":etudiantFields.classList.remove("d-none");break;case"encadrant":encadrantFields.classList.remove("d-none");break}});form.addEventListener("submit",async function(e){e.preventDefault();if(!form.checkValidity()){e.stopPropagation();form.classList.add("was-validated");return}const submitButton=form.querySelector('button[type="submit"]');submitButton.disabled=true;submitButton.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Inscription en cours...';const formData={type:userTypeSelect.value,name:`${document.getElementById("firstName").value} ${document.getElementById("lastName").value}`,email:document.getElementById("email").value,password:document.getElementById("password").value,password_confirmation:document.getElementById("confirmPassword").value};switch(userTypeSelect.value){case"entreprise":formData.company_name=document.getElementById("companyName").value;formData.siret=document.getElementById("siret").value;break;case"etudiant":formData.student_id=document.getElementById("studentId").value;formData.formation=document.getElementById("formation").value;break;case"encadrant":formData.department=document.getElementById("department").value;formData.speciality=document.getElementById("speciality").value;break}try{const response=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(formData)});const data=await response.json();if(response.ok){const alert=document.createElement("div");alert.className="alert alert-success alert-dismissible fade show mt-3";alert.innerHTML=`\n                    <strong>Inscription réussie !</strong> Vous allez être redirigé vers la page de connexion.\n                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n                `;form.insertAdjacentElement("beforebegin",alert);form.reset();form.classList.remove("was-validated");setTimeout(()=>{window.location.href="/login.html"},2e3)}else{throw new Error(data.message||"Erreur lors de l'inscription")}}catch(error){const alert=document.createElement("div");alert.className="alert alert-danger alert-dismissible fade show mt-3";alert.innerHTML=`\n                <strong>Erreur !</strong> ${error.message}\n                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n            `;form.insertAdjacentElement("beforebegin",alert)}finally{submitButton.disabled=false;submitButton.innerHTML="S'inscrire"}});const password=document.getElementById("password");const confirmPassword=document.getElementById("confirmPassword");function validatePassword(){if(password.value!==confirmPassword.value){confirmPassword.setCustomValidity("Les mots de passe ne correspondent pas")}else{confirmPassword.setCustomValidity("")}}password.addEventListener("change",validatePassword);confirmPassword.addEventListener("change",validatePassword)});