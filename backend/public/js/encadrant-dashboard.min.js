document.addEventListener("DOMContentLoaded",function(){const token=localStorage.getItem("auth_token");if(!token){window.location.href="login.html";return}fetch("/api/encadrant/dashboard",{headers:{Authorization:`Bearer ${token}`}}).then(response=>{if(response.status===401){window.location.href="login.html";return}return response.json()}).then(data=>{if(data){populateDashboard(data);initCharts(data)}}).catch(error=>console.error("Error fetching dashboard data:",error));function populateDashboard(data){document.getElementById("totalStudents").textContent=data.stats.total_students||15;document.getElementById("pendingEvaluations").textContent=data.stats.pending_evaluations||5;document.getElementById("completedStages").textContent=data.stats.completed_stages||12;document.getElementById("successRate").textContent=`${data.stats.success_rate||92}%`;const tableBody=document.querySelector("#studentTable tbody");tableBody.innerHTML="";(data.students||[]).forEach(student=>{const row=`\n                <tr>\n                    <td>${student.name}</td>\n                    <td>${student.email}</td>\n                    <td>\n                        <div class="progress" style="width: 100px;">\n                            <div class="progress-bar" role="progressbar" style="width: ${student.progress}%;" aria-valuenow="${student.progress}" aria-valuemin="0" aria-valuemax="100">${student.progress}%</div>\n                        </div>\n                    </td>\n                    <td><span class="badge bg-${student.status==="active"?"success":"warning"}">${student.status}</span></td>\n                    <td>\n                        <button class="btn btn-sm btn-primary me-1" onclick="viewStudent('${student.id}')">View</button>\n                        <button class="btn btn-sm btn-success" onclick="evaluateStudent('${student.id}')">Evaluate</button>\n                    </td>\n                </tr>\n            `;tableBody.innerHTML+=row});const activityList=document.getElementById("activityList");activityList.innerHTML="";(data.recent_activities||[]).forEach(activity=>{const item=`\n                <div class="list-group-item d-flex justify-content-between align-items-center">\n                    <div>\n                        <strong>${activity.student}</strong> - ${activity.activity}\n                    </div>\n                    <small class="text-muted">${new Date(activity.date).toLocaleDateString()}</small>\n                </div>\n            `;activityList.innerHTML+=item})}function initCharts(data){const progressCtx=document.getElementById("progressChart").getContext("2d");new Chart(progressCtx,{type:"line",data:{labels:(data.students||[]).map(s=>s.name),datasets:[{label:"Progress %",data:(data.students||[]).map(s=>s.progress),borderColor:"var(--primary)",backgroundColor:"rgba(var(--primary-rgb), 0.1)",tension:.4}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true,max:100}}}});const evalCtx=document.getElementById("evaluationChart").getContext("2d");new Chart(evalCtx,{type:"doughnut",data:{labels:["Completed","In Progress","Pending"],datasets:[{data:[data.stats.completed_evaluations||10,data.stats.in_progress||3,data.stats.pending_evaluations||5],backgroundColor:["var(--success)","var(--warning)","var(--danger)"]}]},options:{responsive:true,maintainAspectRatio:false}})}document.getElementById("searchInput").addEventListener("keyup",function(){const filter=this.value.toLowerCase();const rows=document.querySelectorAll("#studentTable tbody tr");rows.forEach(row=>{const text=row.textContent.toLowerCase();row.style.display=text.includes(filter)?"":"none"})});document.getElementById("addStudentForm").addEventListener("submit",function(e){e.preventDefault();alert("Student added successfully!");document.querySelector('[data-bs-dismiss="modal"]').click()})});function viewStudent(id){window.location.href=`student-detail.html?id=${id}`}function evaluateStudent(id){window.location.href=`evaluation.html?student=${id}`}