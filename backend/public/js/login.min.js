document.addEventListener("DOMContentLoaded",function(){const form=document.getElementById("loginForm");const togglePassword=document.getElementById("togglePassword");const passwordInput=document.getElementById("password");const rememberMe=document.getElementById("rememberMe");togglePassword.addEventListener("click",function(){const type=passwordInput.getAttribute("type")==="password"?"text":"password";passwordInput.setAttribute("type",type);const icon=this.querySelector("i");icon.classList.toggle("fa-eye");icon.classList.toggle("fa-eye-slash")});if(localStorage.getItem("rememberedEmail")){document.getElementById("email").value=localStorage.getItem("rememberedEmail");rememberMe.checked=true}form.addEventListener("submit",async function(e){e.preventDefault();if(!form.checkValidity()){e.stopPropagation();form.classList.add("was-validated");return}const submitButton=form.querySelector('button[type="submit"]');const buttonText=submitButton.querySelector(".button-text");const spinner=submitButton.querySelector(".spinner-border");submitButton.disabled=true;buttonText.classList.add("d-none");spinner.classList.remove("d-none");const formData={email:document.getElementById("email").value,password:passwordInput.value};try{const response=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(formData)});const data=await response.json();if(response.ok){localStorage.setItem("token",data.access_token);if(rememberMe.checked){localStorage.setItem("rememberedEmail",formData.email)}else{localStorage.removeItem("rememberedEmail")}const alert=document.createElement("div");alert.className="alert alert-success alert-dismissible fade show mt-3";alert.innerHTML=`\n                    <strong>Connexion réussie !</strong> Vous allez être redirigé vers votre tableau de bord.\n                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n                `;form.insertAdjacentElement("beforebegin",alert);setTimeout(()=>{switch(data.user.role){case"admin":window.location.href="/admin/dashboard.html";break;case"etudiant":window.location.href="/etudiant/dashboard.html";break;case"entreprise":window.location.href="/entreprise/dashboard.html";break;case"encadrant":window.location.href="/encadrant/dashboard.html";break;default:window.location.href="/dashboard.html"}},1500)}else{throw new Error(data.message||"Identifiants invalides")}}catch(error){const alert=document.createElement("div");alert.className="alert alert-danger alert-dismissible fade show mt-3";alert.innerHTML=`\n                <strong>Erreur !</strong> ${error.message}\n                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n            `;form.insertAdjacentElement("beforebegin",alert);passwordInput.value="";form.classList.remove("was-validated")}finally{submitButton.disabled=false;buttonText.classList.remove("d-none");spinner.classList.add("d-none")}})});