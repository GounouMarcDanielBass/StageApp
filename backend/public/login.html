<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Login - Internship Management System</title>
		<meta name="description" content="Secure login to your internship management account" />
		<meta name="keywords" content="login, internship, management" />
		<meta name="author" content="Internship Management" />
		<!-- Favicon -->
		<link href="images/favicon.ico" rel="shortcut icon">
		<!-- Bootstrap core CSS -->
		<link href="css/bootstrap.min.css" type="text/css" rel="stylesheet" />
		<link href="css/materialdesignicons.min.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
		<!-- Custom CSS -->
		<link href="css/style.css" rel="stylesheet" type="text/css" id="theme-opt" />
		<link href="css/themes.css" rel="stylesheet" type="text/css" />
		<link href="css/animations.css" rel="stylesheet" type="text/css" />
	</head>
	<body data-theme="light" class="bg-light">
		<!-- Navbar Placeholder -->
		<div id="navbar-placeholder"></div>

		<!-- Login Hero -->
		<section class="bg-home d-flex align-items-center position-relative" style="background: linear-gradient(135deg, var(--primary) 0%, #667eea 100%); min-height: 100vh;">
			<div class="container">
				<div class="row justify-content-center">
					<div class="col-lg-5 col-md-6 col-12">
						<div class="card border-0 shadow-lg rounded-lg p-4 animate-fade-in" style="background: var(--card);">
														<div class="text-center mb-4">
								<img src="images/logo-dark.png" alt="Logo" class="mb-3" height="40">
								<h4 class="text-uppercase fw-semibold mb-2" style="color: var(--heading);">Welcome Back</h4>
								<p class="text-muted mb-0">Sign in to your account</p>
							</div>
							<div id="loginMessage" class="alert alert-info" style="display: none;"></div>
							<form id="loginForm" class="animate-slide-in"></search>
</search_and_replace>
								<div class="mb-3">
									<label class="form-label fw-semibold" for="email">Email Address</label>
									<div class="input-group">
										<span class="input-group-text"><i class="mdi mdi-email-outline"></i></span>
										<input name="email" id="email" type="email" class="form-control" placeholder="Enter your email" required>
									</div>
								</div>
								<div class="mb-3">
									<label class="form-label fw-semibold" for="password">Password</label>
									<div class="input-group">
										<span class="input-group-text"><i class="mdi mdi-lock-outline"></i></span>
										<input type="password" class="form-control" id="password" placeholder="Enter your password" required>
										<button class="btn btn-outline-secondary" type="button" id="togglePassword">
											<i class="mdi mdi-eye-outline"></i>
										</button>
									</div>
								</div>
								<div class="d-flex justify-content-between mb-3">
									<div class="form-check">
										<input class="form-check-input" type="checkbox" value="" id="rememberMe">
										<label class="form-check-label text-muted" for="rememberMe">Remember me</label>
									</div>
									<a href="#" class="text-muted small">Forgot password?</a>
								</div>
								<button class="btn btn-primary w-100 mb-3 animate-bounce-in" type="submit">
									<span id="loginText">Sign In</span>
									<span id="loginSpinner" class="spinner-border spinner-border-sm ms-2" role="status" style="display: none;"></span>
								</button>
								<div class="text-center">
									<p class="mb-0 text-muted">Don't have an account? <a href="signup.html" class="fw-semibold" style="color: var(--primary);">Sign up</a></p>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Footer Placeholder -->
		<div id="footer-placeholder"></div>

		<!-- JAVASCRIPTS -->
		<script src="js/bootstrap.bundle.min.js"></script>
		<script src="js/feather.min.js"></script>
		<script src="js/plugins.init.js"></script>
		<script src="js/app.js"></script>
		<script src="js/components.js"></script>
		<script src="js/theme.js"></script>

		<!-- Custom Scripts -->
		<script>
			// Password toggle
			document.getElementById('togglePassword').addEventListener('click', function() {
				const passwordField = document.getElementById('password');
				const icon = this.querySelector('i');
				if (passwordField.type === 'password') {
					passwordField.type = 'text';
					icon.classList.remove('mdi-eye-outline');
					icon.classList.add('mdi-eye-off-outline');
				} else {
					passwordField.type = 'password';
					icon.classList.remove('mdi-eye-off-outline');
					icon.classList.add('mdi-eye-outline');
				}
			});

			// Login Form
			document.getElementById('loginForm').addEventListener('submit', async function(e) {
				e.preventDefault();
				const email = document.getElementById('email').value;
				const password = document.getElementById('password').value;
				const submitBtn = this.querySelector('button[type="submit"]');
				const loginText = document.getElementById('loginText');
				const loginSpinner = document.getElementById('loginSpinner');

				// Show loading
				loginText.style.display = 'none';
				loginSpinner.style.display = 'inline-block';
				submitBtn.disabled = true;

				try {
					const response = await fetch('http://127.0.0.1:8000/api/auth/login', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
							'Accept': 'application/json'
						},
						body: JSON.stringify({ email, password })
					});

					const data = await response.json();

					if (response.ok) {
					    localStorage.setItem('auth_token', data.access_token);
					    let redirectUrl;
					    switch(data.user.role) {
					        case 'admin':
					            redirectUrl = 'admin-dashboard.html';
					            break;
					        case 'etudiant':
					            redirectUrl = 'student-dashboard.html';
					            break;
					        case 'entreprise':
					            redirectUrl = 'dashboard-entreprise.html';
					            break;
					        case 'encadrant':
					            redirectUrl = 'dashboard-encadrant.html';
					            break;
					        default:
					            redirectUrl = 'dashboard.html';
					    }
					    window.location.href = redirectUrl;
					} else {
						alert(data.message || 'Login failed. Please try again.');
					}
				} catch (error) {
					console.error('Login error:', error);
					alert('An error occurred. Please try again.');
				} finally {
					// Hide loading
					loginText.style.display = 'inline';
					loginSpinner.style.display = 'none';
					submitBtn.disabled = false;
				}
			});

						// Initialize Feather icons (already done in components.js, but safe to call again)
			feather.replace();

			// Check for message in URL and display it
			const urlParams = new URLSearchParams(window.location.search);
			const message = urlParams.get('message');
			if (message) {
				const messageDiv = document.getElementById('loginMessage');
				if (messageDiv) {
					messageDiv.textContent = decodeURIComponent(message);
					messageDiv.style.display = 'block';
				}
			}
		</script></search>
</search_and_replace>
	</body>
</html>